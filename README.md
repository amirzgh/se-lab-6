# استقرار یک نرم افزار مبتنی بر MicroService به کمک Docker

#### آزمایش ششم درس آز مهندسی نرم افزار 
---
### گزارش آزمایش:
در ابتدا برنامه مورد نظر را با استفاده از node , express می نویسیم از اون جایی که قرار است به صورت میکروسرویس برنامه را پیاده سازی کنیم بک اند که با استفاده از Express پیاده سازی و دیتابیس که با استفاده از Postgres نوشته شده را به صورت کاملا مجزا ساخته و جلو می بریم و برای هر یک یک فایل داکری جدا می نوسیم سپس با استفاده از Docker composer به یک
دیگر متصل خواهیم کرد
به صورت زیر برنامه را می نویسیم 
![image](https://github.com/amirzgh/se-lab-6/assets/59364450/b46135ee-a8d2-469c-9a45-58c17c2544c0)
سپس برای آن فایل داکری می نویسیم 
![image](https://github.com/amirzgh/se-lab-6/assets/59364450/5cde06b2-65c0-483f-aef5-36e23e86fff2)
که به ترتیب به توضیح هر خط می پردازیم : 
- خط 2: ورژن node مورد نظر را وارد می کنیم
- خط 5: نیاز است مشخش کنیم working directory کجا باشد
- خط 8: فایل package*.json را کپی می کنیم
- خط 11: کتابخانه هایی که در package*.json وجود دارد را دانلود و نصب می کنیم
- خط 14: بقیه فایل های موجود را کپی و منتقل می کنیم
- خط 17: پورت برنامه را مشخص می کنیم
- خط 20: با استفاده از دستور npm start برنامه را ران می کنیم

  پس از آن می توان با استفاده از دستور
   `  docker build -t [name] .  `
  می توان به صورت جداگانه داکر فایل را بیلد و فایل image ساخت ( لازم به ذکر است چون جلو تر از Docker-composer استفاده می کنیم نیازی به این کار نیست )
  

![Screenshot 2023-08-25 123312](https://github.com/amirzgh/se-lab-6/assets/59364450/7e10f639-d3fe-45d0-a164-82d41466d43f)

---
حال به سراغ میکروسرویس بعدی یعنی دیتابیس می رویم 
بهتر است از قبل بر روی سیستم خود postgres را نصب داشته باشم 
سپس در پوشه مجزایی که برای آن ساخته ایم داکر فایل آن را به صورت زیر تنظیم می کنیم 
![image](https://github.com/amirzgh/se-lab-6/assets/59364450/ccd54036-d081-42d3-a3a0-d110579a1825)
که به ترتیب به توضیح هر خط می پردازیم : 
- خط 2: ورژن postgres را مشخص می کنیم و مشخص می کنیم که داکر فایل مربوط به postgres می باشد
- خط 5 و 6 و 7: مربوط به تنظیمات دیتابیس مورد نظر می باشد که آن را برای اتصال داخل برنامه نیاز داریم

  ---
  در صورتی که هر داکر فایل را بیلد کنیم و کانترنر بسازیم با زدن دستور های 
  ```
  docker ps
  docker image ls
  ```
نتیجه زیر حاصل می شود نتیجه ( نتیجه docker ps شامل کانتینر ها و نتیجه docker image ls  شامل image های ساخته شده می باشد)
![Screenshot 2023-08-25 130605](https://github.com/amirzgh/se-lab-6/assets/59364450/431cd892-4436-48e5-8c81-72a91eba7c6d)

لازم به ذکر است می توان همه این موارد را داخل نرم افزار داکر نیز مشاهده نمود 
![Screenshot 2023-08-25 125901](https://github.com/amirzgh/se-lab-6/assets/59364450/3b8be235-aeb6-43d1-9e6d-5ebc2f951d53)

---
پس از آن نیاز داریم برای راحتی کار از docker-composer استفاده کنیم که خود مسایل مربوط به network و متصل کردن image ها و کانتینر ها را انجام دهد 
برای این کار داخل پوشه پدر که میکروسرویس ها در آن قرار دارند یک فایل با نام docker-compose.yml می سازیم و داخل آن باید ادرس داکر فایل ها را قرار دهیم 
![image](https://github.com/amirzgh/se-lab-6/assets/59364450/0b653cc2-01a3-46b2-a447-1c36f2b15a60)

که به ترتیب به توضیح هر خط می پردازیم : 
- خط 1: در این خط ورژن کامپوسر را مشخص می کنیم 
- خط 2: شروع به تعریف سرویس ها می کنیم
- خط 3: اسم سرویس
- خط 4: ادرس محل داکر فایل
- خط 5: پورت ها را مشخص می کنیم و پورت داکر را به پورت سیستم نیز آساین می کنیم
- خط 7: در این جا می گویم این سرویس نیازمند به سرویس دیگر می باشد و اول باید سرویس دیگر اجرا شود
- خط 10 تا اخر : مانند توضیحات قبل می باشد با این تفاوت که در قسمت environment با توجه به این که چه چیزی را داریم داکری می کنیم نیاز داریم کانفیگ های مورد نیاز را بدیم در این جا اسم و یوزرنیم و پسورد دیتابیس می باشد  



